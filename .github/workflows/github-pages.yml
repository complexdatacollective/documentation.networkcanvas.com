name: Build documentation site

on:
  push:
      branches:
       - master

jobs:
  jekyll:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Checkout submodules
      run: git submodule update --init --recursive
    - name: ðŸ’Ž setup ruby
      uses: ruby/setup-ruby@v1
      with:
        ruby-version: 2.6
    # Standard usage
    - name: ðŸ”¨ install dependencies & build site
      uses: limjh16/jekyll-action-ts@v2
      with:
        enable_cache: true
    - name: ðŸš€ deploy
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./_site
        name: DEPLOY
    - name: rsync deployments
      uses: burnett01/rsync-deployments@5.1
      with:
        switches: -avzr --delete
        path: _site
        remote_path: /var/www/documentation.networkcanvas.com/
        remote_host: networkcanvas.com
        remote_user: deploy
        remote_key: ${{ secrets.DEPLOY_PK }}
